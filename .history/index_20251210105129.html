<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>T√≠nh Thu·∫ø TNCN 2025 vs 2026</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>T√≠nh Thu·∫ø TNCN</h1>
      <p class="subtitle">So s√°nh Lu·∫≠t thu·∫ø 2025 (hi·ªán h√†nh) vs D·ª± th·∫£o 2026</p>
    </header>

    <section class="input-section">
      <div class="input-grid">
        <div class="form-group">
          <label for="grossIncome">Thu nh·∫≠p Gross (VNƒê/th√°ng)</label>
          <input type="text" id="grossIncome" placeholder="50,000,000" inputmode="numeric">
        </div>
        <div class="form-group">
          <label for="dependents">S·ªë ng∆∞·ªùi ph·ª• thu·ªôc</label>
          <input type="number" id="dependents" value="0" min="0" max="20">
        </div>
        <button class="btn" onclick="calculate()">T√≠nh thu·∫ø</button>
      </div>
    </section>

    <section class="result-section" id="resultSection">
      <div class="result-card">
        <div class="result-header">
          <h2>üìä K·∫øt qu·∫£ t√≠nh thu·∫ø</h2>
        </div>
        <table>
          <thead>
            <tr>
              <th>M·ª•c</th>
              <th>2025 (Hi·ªán h√†nh)</th>
              <th>2026 (D·ª± th·∫£o)</th>
            </tr>
          </thead>
          <tbody id="resultBody">
          </tbody>
        </table>
      </div>
    </section>

    <section class="result-section" id="refundSection">
      <div class="result-card refund-card">
        <div class="result-header">
          <h2>üßæ ƒê√≥ng Full ‚Üí Ho√†n thu·∫ø cu·ªëi nƒÉm</h2>
          <p class="header-note">Gi·∫£ ƒë·ªãnh: Kh√¥ng khai gi·∫£m tr·ª´ gia c·∫£nh h√†ng th√°ng, quy·∫øt to√°n ho√†n thu·∫ø cu·ªëi nƒÉm</p>
        </div>
        <table>
          <thead>
            <tr>
              <th>M·ª•c</th>
              <th>2025 (Hi·ªán h√†nh)</th>
              <th>2026 (D·ª± th·∫£o)</th>
            </tr>
          </thead>
          <tbody id="refundBody">
          </tbody>
        </table>
      </div>
    </section>

    <footer>
      <p>M·ª©c tr·∫ßn BHXH: 36,000,000 VNƒê ¬∑ T·ª∑ l·ªá BH: 10.5%</p>
    </footer>
  </div>

  <script>
    const TAX_CONFIG = {
      insuranceRate: 0.105,
      insuranceCap: 36_000_000,
      personalDeduction: { old: 11_000_000, new: 15_500_000 },
      dependentDeduction: { old: 4_400_000, new: 6_200_000 },
      bracketsOld: [
        [5_000_000, 0.05],
        [10_000_000, 0.10],
        [18_000_000, 0.15],
        [32_000_000, 0.20],
        [52_000_000, 0.25],
        [80_000_000, 0.30],
        [Infinity, 0.35],
      ],
      bracketsNew: [
        [10_000_000, 0.05],
        [30_000_000, 0.15],
        [60_000_000, 0.25],
        [100_000_000, 0.30],
        [Infinity, 0.35],
      ],
    };

    function calculateProgressiveTax(taxableIncome, brackets) {
      if (taxableIncome <= 0) return 0;
      let tax = 0, prev = 0;
      for (const [threshold, rate] of brackets) {
        const taxable = Math.min(taxableIncome, threshold) - prev;
        if (taxable <= 0) break;
        tax += taxable * rate;
        prev = threshold;
      }
      return tax;
    }

    function calculatePIT(grossIncome, dependents) {
      const cfg = TAX_CONFIG;
      const insurableIncome = Math.min(grossIncome, cfg.insuranceCap);
      const insurance = insurableIncome * cfg.insuranceRate;
      const incomeAfterInsurance = grossIncome - insurance;

      const deductionOld = cfg.personalDeduction.old + cfg.dependentDeduction.old * dependents;
      const deductionNew = cfg.personalDeduction.new + cfg.dependentDeduction.new * dependents;

      const taxableOld = Math.max(0, incomeAfterInsurance - deductionOld);
      const taxableNew = Math.max(0, incomeAfterInsurance - deductionNew);

      const taxOld = calculateProgressiveTax(taxableOld, cfg.bracketsOld);
      const taxNew = calculateProgressiveTax(taxableNew, cfg.bracketsNew);

      // Thu·∫ø khi ƒë√≥ng full (kh√¥ng gi·∫£m tr·ª´ gia c·∫£nh, ch·ªâ tr·ª´ BH)
      const taxNoDeductOld = calculateProgressiveTax(incomeAfterInsurance, cfg.bracketsOld);
      const taxNoDeductNew = calculateProgressiveTax(incomeAfterInsurance, cfg.bracketsNew);

      return {
        grossIncome,
        dependents,
        insurance,
        incomeAfterInsurance,
        deductionOld,
        deductionNew,
        taxableOld,
        taxableNew,
        taxOld,
        taxNew,
        taxNoDeductOld,
        taxNoDeductNew,
        taxSaved: taxOld - taxNew,
        netOld: grossIncome - insurance - taxOld,
        netNew: grossIncome - insurance - taxNew,
      };
    }

    function formatMoney(n) {
      return n.toLocaleString('vi-VN') + ' ‚Ç´';
    }

    function parseMoneyInput(str) {
      return parseInt(str.replace(/[^\d]/g, ''), 10) || 0;
    }

    function calculate() {
      const grossIncome = parseMoneyInput(document.getElementById('grossIncome').value);
      const dependents = parseInt(document.getElementById('dependents').value, 10) || 0;

      if (grossIncome <= 0) {
        alert('Vui l√≤ng nh·∫≠p thu nh·∫≠p Gross h·ª£p l·ªá');
        return;
      }

      const r = calculatePIT(grossIncome, dependents);

      const rows = [
        { label: 'Thu nh·∫≠p Gross', old: formatMoney(r.grossIncome), new: formatMoney(r.grossIncome) },
        { label: 'B·∫£o hi·ªÉm b·∫Øt bu·ªôc (10.5%)', old: formatMoney(r.insurance), new: formatMoney(r.insurance), info: true },
        { label: 'Thu nh·∫≠p sau BH', old: formatMoney(r.incomeAfterInsurance), new: formatMoney(r.incomeAfterInsurance) },
        { label: 'Gi·∫£m tr·ª´ b·∫£n th√¢n', old: formatMoney(TAX_CONFIG.personalDeduction.old), new: formatMoney(TAX_CONFIG.personalDeduction.new) },
        { label: `Gi·∫£m tr·ª´ NPT (√ó${dependents})`, old: formatMoney(TAX_CONFIG.dependentDeduction.old * dependents), new: formatMoney(TAX_CONFIG.dependentDeduction.new * dependents) },
        { label: 'T·ªïng gi·∫£m tr·ª´', old: formatMoney(r.deductionOld), new: formatMoney(r.deductionNew) },
        { label: 'Thu nh·∫≠p t√≠nh thu·∫ø', old: formatMoney(r.taxableOld), new: formatMoney(r.taxableNew) },
        { label: 'Thu·∫ø TNCN ph·∫£i n·ªôp', old: formatMoney(r.taxOld), new: formatMoney(r.taxNew) },
        { label: 'Thu nh·∫≠p NET', old: formatMoney(r.netOld), new: formatMoney(r.netNew) },
      ];

      let html = rows.map(row => `
        <tr class="${row.info ? 'info-row' : ''}">
          <td class="col-label">${row.label}</td>
          <td class="col-old">${row.old}</td>
          <td class="col-new">${row.new}</td>
        </tr>
      `).join('');

      html += `
        <tr class="highlight-row">
          <td class="col-label">üí∞ TI·ªÄN THU·∫æ GI·∫¢M/TH√ÅNG</td>
          <td colspan="2" class="saved-value" style="text-align: center;">
            ${r.taxSaved >= 0 ? '+' : ''}${formatMoney(r.taxSaved)}
          </td>
        </tr>
        <tr class="highlight-row">
          <td class="col-label">üìÖ TI·ªÄN THU·∫æ GI·∫¢M/NƒÇM</td>
          <td colspan="2" class="saved-value" style="text-align: center;">
            ${r.taxSaved >= 0 ? '+' : ''}${formatMoney(r.taxSaved * 12)}
          </td>
        </tr>
      `;

      document.getElementById('resultBody').innerHTML = html;

      // Refund section: ƒë√≥ng full kh√¥ng gi·∫£m tr·ª´, ho√†n thu·∫ø cu·ªëi nƒÉm
      const refundOld = r.taxNoDeductOld * 12 - r.taxOld * 12;
      const refundNew = r.taxNoDeductNew * 12 - r.taxNew * 12;

      document.getElementById('refundBody').innerHTML = `
        <tr>
          <td class="col-label">Thu·∫ø ƒë√≥ng/th√°ng (kh√¥ng gi·∫£m tr·ª´)</td>
          <td class="col-old">${formatMoney(r.taxNoDeductOld)}</td>
          <td class="col-new">${formatMoney(r.taxNoDeductNew)}</td>
        </tr>
        <tr>
          <td class="col-label">Thu·∫ø ƒë√≥ng c·∫£ nƒÉm (kh√¥ng gi·∫£m tr·ª´)</td>
          <td class="col-old">${formatMoney(r.taxNoDeductOld * 12)}</td>
          <td class="col-new">${formatMoney(r.taxNoDeductNew * 12)}</td>
        </tr>
        <tr>
          <td class="col-label">Thu·∫ø th·ª±c t·∫ø c·∫£ nƒÉm (c√≥ gi·∫£m tr·ª´)</td>
          <td class="col-old">${formatMoney(r.taxOld * 12)}</td>
          <td class="col-new">${formatMoney(r.taxNew * 12)}</td>
        </tr>
        <tr class="highlight-row refund-row">
          <td class="col-label">üîÑ TI·ªÄN HO√ÄN THU·∫æ CU·ªêI NƒÇM</td>
          <td class="saved-value">${formatMoney(refundOld)}</td>
          <td class="saved-value">${formatMoney(refundNew)}</td>
        </tr>
      `;
      document.getElementById('refundSection').classList.add('show');
      document.getElementById('resultSection').classList.add('show');
    }

    // Format input on type
    document.getElementById('grossIncome').addEventListener('input', function(e) {
      const raw = this.value.replace(/[^\d]/g, '');
      if (raw) {
        this.value = parseInt(raw, 10).toLocaleString('vi-VN');
      }
    });

    // Enter to calculate
    document.querySelectorAll('input').forEach(input => {
      input.addEventListener('keypress', e => {
        if (e.key === 'Enter') calculate();
      });
    });
  </script>
</body>
</html>

