const TAX_CONFIG = { bhxh: { rate: .08, cap: 468e5 }, bhyt: { rate: .015, cap: 468e5 }, bhtn: { rate: .01 }, bhtnCaps: { 1: 992e5, 2: 882e5, 3: 772e5, 4: 69e6 }, bhxhCompany: { rate: .175, cap: 468e5 }, bhytCompany: { rate: .03, cap: 468e5 }, bhtnCompany: { rate: .01 }, personalDeduction: { old: 11e6, new: 155e5 }, dependentDeduction: { old: 44e5, new: 62e5 }, bracketsOld: [[5e6, .05], [1e7, .1], [18e6, .15], [32e6, .2], [52e6, .25], [8e7, .3], [1 / 0, .35]], bracketsNew: [[1e7, .05], [3e7, .15], [6e7, .25], [1e8, .3], [1 / 0, .35]] }; let incomeType = "gross"; function calculateProgressiveTax(e, t) { if (e <= 0) return 0; let n = 0, o = 0; for (const [a, l] of t) { const t = Math.min(e, a) - o; if (t <= 0) break; n += t * l, o = a } return n } function calcInsurance(e, t, n) { return Math.min(e, n) * t } function getRegion() { const e = document.getElementById("region"); return e ? parseInt(e.value, 10) : 1 } function getBhtnCap() { return TAX_CONFIG.bhtnCaps[getRegion()] } function calculatePIT(e, t) { const n = TAX_CONFIG, o = getBhtnCap(), a = calcInsurance(e, n.bhxh.rate, n.bhxh.cap), l = calcInsurance(e, n.bhyt.rate, n.bhyt.cap), c = calcInsurance(e, n.bhtn.rate, o), r = a + l + c, s = e - r, d = n.personalDeduction.old + n.dependentDeduction.old * t, u = n.personalDeduction.new + n.dependentDeduction.new * t, h = Math.max(0, s - d), i = Math.max(0, s - u), m = calculateProgressiveTax(h, n.bracketsOld), y = calculateProgressiveTax(i, n.bracketsNew); return { grossIncome: e, dependents: t, bhxh: a, bhyt: l, bhtn: c, insurance: r, incomeAfterInsurance: s, deductionOld: d, deductionNew: u, taxableOld: h, taxableNew: i, taxOld: m, taxNew: y, taxNoDeductOld: calculateProgressiveTax(s, n.bracketsOld), taxNoDeductNew: calculateProgressiveTax(s, n.bracketsNew), taxSaved: m - y, netOld: e - r - m, netNew: e - r - y } } function netToGross(e, t) { let n = e, o = 2 * e; for (let a = 0; a < 50; a++) { const a = Math.floor((n + o) / 2), l = calculatePIT(a, t).netOld; if (Math.abs(l - e) < 1e3) return a; l < e ? n = a : o = a } return Math.floor((n + o) / 2) } function formatMoney(e) { return e.toLocaleString("vi-VN") + " â‚«" } function calcCompanyInsurance(e) { const t = TAX_CONFIG, n = getBhtnCap(); return calcInsurance(e, t.bhxhCompany.rate, t.bhxhCompany.cap) + calcInsurance(e, t.bhytCompany.rate, t.bhytCompany.cap) + calcInsurance(e, t.bhtnCompany.rate, n) } function renderNetAsGross(e, t) { const n = calculatePIT(e, t), o = netToGross(e, t), a = calculatePIT(o, t), l = calcCompanyInsurance(e), c = e + l + n.taxOld, r = calcCompanyInsurance(o), s = o + r, d = s - c; let u = [{ label: "Net thá»±c nháº­n", wrong: formatMoney(e), correct: formatMoney(e) }, { label: "Gross Ä‘á»ƒ tÃ­nh thuáº¿", wrong: formatMoney(e), correct: formatMoney(o), highlight: !0 }, { label: "Thuáº¿ TNCN (CT tráº£)", wrong: formatMoney(n.taxOld), correct: formatMoney(a.taxOld), highlight: !0 }, { label: "BH cÃ´ng ty Ä‘Ã³ng (21.5%)", wrong: formatMoney(l), correct: formatMoney(r), info: !0 }, { label: "Tá»•ng CT chi/thÃ¡ng", wrong: formatMoney(c), correct: formatMoney(s) }].map(e => `\n    <tr class="${e.info ? "info-row" : ""} ${e.highlight ? "diff-row" : ""}">\n      <td class="col-label">${e.label}</td>\n      <td class="col-old">${e.wrong}</td>\n      <td class="col-new">${e.correct}</td>\n    </tr>\n  `).join(""); u += `\n    <tr class="highlight-row">\n      <td class="col-label">ğŸ’¸ CT TIáº¾T KIá»†M (sai cÃ¡ch)/THÃNG</td>\n      <td colspan="2" class="saved-value" style="text-align: center;">\n        ${formatMoney(d)}\n      </td>\n    </tr>\n    <tr class="highlight-row">\n      <td class="col-label">ğŸ“… CT TIáº¾T KIá»†M (sai cÃ¡ch)/NÄ‚M</td>\n      <td colspan="2" class="saved-value" style="text-align: center;">\n        ${formatMoney(12 * d)}\n      </td>\n    </tr>\n  `, document.getElementById("resultBody").innerHTML = u, document.querySelector("#resultSection .result-header h2").textContent = "ğŸ“Š So sÃ¡nh: Nâ†’G vs TÃ­nh Ä‘Ãºng", document.querySelector("#resultSection thead").innerHTML = "\n    <tr>\n      <th>Má»¥c</th>\n      <th>Nâ†’G (sai cÃ¡ch)</th>\n      <th>TÃ­nh Ä‘Ãºng (Net)</th>\n    </tr>\n  ", document.getElementById("resultSection").classList.add("show"), document.getElementById("refundSection").classList.remove("show") } function parseMoneyInput(e) { return parseInt(e.replace(/[^\d]/g, ""), 10) || 0 } function calculate() { const e = parseMoneyInput(document.getElementById("incomeInput").value), t = parseInt(document.getElementById("dependents").value, 10) || 0; if (e <= 0) return void alert("Vui lÃ²ng nháº­p thu nháº­p há»£p lá»‡"); if ("net-as-gross" === incomeType) return void renderNetAsGross(e, t); let n; n = "net" === incomeType ? netToGross(e, t) : e; const o = calculatePIT(n, t); document.querySelector("#resultSection .result-header h2").textContent = "ğŸ“Š Káº¿t quáº£ tÃ­nh thuáº¿", document.querySelector("#resultSection thead").innerHTML = "\n    <tr>\n      <th>Má»¥c</th>\n      <th>2025 (Hiá»‡n hÃ nh)</th>\n      <th>2026 (Dá»± tháº£o)</th>\n    </tr>\n  "; let a = [{ label: "Thu nháº­p Gross", old: formatMoney(o.grossIncome), new: formatMoney(o.grossIncome) }, { label: "â”” BHXH (8%)", old: formatMoney(o.bhxh), new: formatMoney(o.bhxh), info: !0 }, { label: "â”” BHYT (1.5%)", old: formatMoney(o.bhyt), new: formatMoney(o.bhyt), info: !0 }, { label: "â”” BHTN (1%)", old: formatMoney(o.bhtn), new: formatMoney(o.bhtn), info: !0 }, { label: "Tá»•ng BH báº¯t buá»™c (10.5%)", old: formatMoney(o.insurance), new: formatMoney(o.insurance) }, { label: "Thu nháº­p chá»‹u thuáº¿", old: formatMoney(o.incomeAfterInsurance), new: formatMoney(o.incomeAfterInsurance) }, { label: "â”” Giáº£m trá»« báº£n thÃ¢n", old: formatMoney(TAX_CONFIG.personalDeduction.old), new: formatMoney(TAX_CONFIG.personalDeduction.new), info: !0 }, { label: `â”” Giáº£m trá»« NPT (Ã—${t})`, old: formatMoney(TAX_CONFIG.dependentDeduction.old * t), new: formatMoney(TAX_CONFIG.dependentDeduction.new * t), info: !0 }, { label: "Tá»•ng giáº£m trá»«", old: formatMoney(o.deductionOld), new: formatMoney(o.deductionNew) }, { label: "Thu nháº­p tÃ­nh thuáº¿", old: formatMoney(o.taxableOld), new: formatMoney(o.taxableNew) }, { label: "Thuáº¿ TNCN pháº£i ná»™p", old: formatMoney(o.taxOld), new: formatMoney(o.taxNew) }, { label: "Thu nháº­p NET", old: formatMoney(o.netOld), new: formatMoney(o.netNew) }].map(e => `\n    <tr class="${e.info ? "info-row" : ""}">\n      <td class="col-label">${e.label}</td>\n      <td class="col-old">${e.old}</td>\n      <td class="col-new">${e.new}</td>\n    </tr>\n  `).join(""); a += `\n    <tr class="highlight-row">\n      <td class="col-label">ğŸ’° TIá»€N THUáº¾ GIáº¢M/THÃNG</td>\n      <td colspan="2" class="saved-value" style="text-align: center;">\n        ${o.taxSaved >= 0 ? "+" : ""}${formatMoney(o.taxSaved)}\n      </td>\n    </tr>\n    <tr class="highlight-row">\n      <td class="col-label">ğŸ“… TIá»€N THUáº¾ GIáº¢M/NÄ‚M</td>\n      <td colspan="2" class="saved-value" style="text-align: center;">\n        ${o.taxSaved >= 0 ? "+" : ""}${formatMoney(12 * o.taxSaved)}\n      </td>\n    </tr>\n  `, document.getElementById("resultBody").innerHTML = a; const l = 12 * o.taxNoDeductOld - 12 * o.taxOld, c = 12 * o.taxNoDeductNew - 12 * o.taxNew; document.getElementById("refundBody").innerHTML = `\n    <tr>\n      <td class="col-label">Thuáº¿ Ä‘Ã³ng/thÃ¡ng (khÃ´ng giáº£m trá»«)</td>\n      <td class="col-old">${formatMoney(o.taxNoDeductOld)}</td>\n      <td class="col-new">${formatMoney(o.taxNoDeductNew)}</td>\n    </tr>\n    <tr>\n      <td class="col-label">Thuáº¿ Ä‘Ã³ng cáº£ nÄƒm (khÃ´ng giáº£m trá»«)</td>\n      <td class="col-old">${formatMoney(12 * o.taxNoDeductOld)}</td>\n      <td class="col-new">${formatMoney(12 * o.taxNoDeductNew)}</td>\n    </tr>\n    <tr>\n      <td class="col-label">Thuáº¿ thá»±c táº¿ cáº£ nÄƒm (cÃ³ giáº£m trá»«)</td>\n      <td class="col-old">${formatMoney(12 * o.taxOld)}</td>\n      <td class="col-new">${formatMoney(12 * o.taxNew)}</td>\n    </tr>\n    <tr class="highlight-row refund-row">\n      <td class="col-label">ğŸ”„ TIá»€N HOÃ€N THUáº¾ CUá»I NÄ‚M</td>\n      <td class="saved-value">${formatMoney(l)}</td>\n      <td class="saved-value">${formatMoney(c)}</td>\n    </tr>\n  `, document.getElementById("refundSection").classList.add("show"), document.getElementById("resultSection").classList.add("show") } function updateBhtnCapDisplay() { const e = getRegion(), t = (TAX_CONFIG.bhtnCaps[e] / 1e6).toFixed(1) + "M"; document.getElementById("bhtnCapDisplay").textContent = t } function toggleRegionNote() { document.getElementById("regionModal").classList.toggle("show") } document.querySelectorAll(".toggle-btn").forEach(e => { e.addEventListener("click", function () { document.querySelectorAll(".toggle-btn").forEach(e => e.classList.remove("active")), this.classList.add("active"), incomeType = this.dataset.type; document.getElementById("incomeLabel").textContent = { gross: "Thu nháº­p Gross (VNÄ/thÃ¡ng)", net: "Thu nháº­p Net (VNÄ/thÃ¡ng)", "net-as-gross": "Net lÃ m Gross (VNÄ/thÃ¡ng)" }[incomeType] }) }), document.getElementById("incomeInput").addEventListener("input", function () { const e = this.value.replace(/[^\d]/g, ""); e && (this.value = parseInt(e, 10).toLocaleString("vi-VN")) }), document.querySelectorAll("input").forEach(e => { e.addEventListener("keypress", e => { "Enter" === e.key && calculate() }) }), document.getElementById("region").addEventListener("change", updateBhtnCapDisplay), updateBhtnCapDisplay(), document.getElementById("regionModal").addEventListener("click", function (e) { e.target === this && this.classList.remove("show") });